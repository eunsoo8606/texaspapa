<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %>
    </title>
    <meta name="description" content="<%= locals.description || '텍사스파파 - 소자본 크레페 창업의 새로운 기준' %>">

    <!-- Open Graph -->
    <meta property="og:title" content="<%= title %>">
    <meta property="og:description" content="<%= locals.description || '텍사스파파 - 소자본 크레페 창업의 새로운 기준' %>">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://texaspapa.co.kr/community/<%= locals.currentTab %>">

    <%- include('../partials/favicons') %>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/community.css">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&family=Outfit:wght@400;700&display=swap"
            rel="stylesheet">
</head>

<body>
    <div class="wrapper">
        <%- include('../partials/nav', { activePage: activePage }) %>

            <main class="sub-page">
                <!-- 커뮤니티 헤더 (전체 너비) -->
                <div class="community-hero">
                    <h1 class="community-title fade-up">COMMUNITY</h1>
                </div>

                <div class="community-section">
                    <div class="community-container">
                        <!-- 탭 내비게이션 -->
                        <nav class="community-tabs fade-up">
                            <a href="/community/notice"
                                class="tab-item <%= currentTab === 'notice' ? 'active' : '' %>">공지사항</a>
                            <a href="/community/event"
                                class="tab-item <%= currentTab === 'event' ? 'active' : '' %>">이벤트</a>
                            <a href="/community/faq"
                                class="tab-item <%= currentTab === 'faq' ? 'active' : '' %>">FAQ</a>
                            <a href="/community/voice"
                                class="tab-item <%= currentTab === 'voice' ? 'active' : '' %>">고객의소리</a>
                            <a href="/community/inquiry"
                                class="tab-item <%= currentTab === 'inquiry' ? 'active' : '' %>">문의게시판</a>
                        </nav>

                        <!-- 문의하기 버튼 (문의게시판, 고객의소리만) -->
                        <% if (currentTab==='inquiry' || currentTab==='voice' ) { %>
                            <div class="write-btn-container" style="text-align: right; margin-bottom: 20px;">
                                <a href="/community/<%= currentTab %>/write" class="write-btn">
                                    <i class="fas fa-pen"></i> 문의하기
                                </a>
                            </div>
                            <% } %>

                                <!-- 성공 메시지 -->
                                <% if (typeof query !=='undefined' && query.success==='1' ) { %>
                                    <div class="success-message"
                                        style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #28a745;">
                                        <i class="fas fa-check-circle"></i> 문의가 성공적으로 등록되었습니다. 빠른 시일 내에 답변드리겠습니다.
                                    </div>
                                    <% } %>

                                        <div class="community-content fade-up">
                                            <% if (posts && posts.length> 0) { %>
                                                <div class="notice-list">
                                                    <% posts.forEach((post, index)=> { %>
                                                        <div class="notice-item">
                                                            <% if (post.top_yn==='Y' ) { %>
                                                                <span class="ni-num"><i class="fa-solid fa-bullhorn"
                                                                        style="color: var(--primary-blue);"></i></span>
                                                                <% } else { %>
                                                                    <span class="ni-num">
                                                                        <%= pagination.totalPosts -
                                                                            ((pagination.currentPage - 1) * 10 + index)
                                                                            %>
                                                                    </span>
                                                                    <% } %>
                                                                        <div class="ni-content">
                                                                            <a href="/community/<%= currentTab %>/<%= post.post_no %>"
                                                                                class="ni-title">
                                                                                <% if (post.top_yn==='Y' ) { %>
                                                                                    <span
                                                                                        class="ni-badge important">공지</span>
                                                                                    <% } %>
                                                                                        <% if (currentTab==='inquiry' ||
                                                                                            currentTab==='voice' ) { %>
                                                                                            <% if
                                                                                                (post.status==='pending'
                                                                                                ) { %>
                                                                                                <span class="ni-badge"
                                                                                                    style="background: #ffc107; color: #000;">답변대기</span>
                                                                                                <% } else if
                                                                                                    (post.status==='answered'
                                                                                                    ) { %>
                                                                                                    <span
                                                                                                        class="ni-badge"
                                                                                                        style="background: #28a745; color: #fff;">답변완료</span>
                                                                                                    <% } %>
                                                                                                        <% } %>
                                                                                                            <%= post.title
                                                                                                                %>
                                                                            </a>
                                                                            <span class="ni-date">
                                                                                <%= new
                                                                                    Date(post.create_dt).toISOString().split('T')[0]
                                                                                    %>
                                                                            </span>
                                                                        </div>
                                                        </div>
                                                        <% }); %>
                                                </div>

                                                <% if (pagination.totalPages> 1) { %>
                                                    <div class="pagination fade-up">
                                                        <% if (pagination.currentPage> 1) { %>
                                                            <a href="/community/<%= currentTab %>?page=<%= pagination.currentPage - 1 %>"
                                                                class="pg-btn">‹</a>
                                                            <% } %>

                                                                <% for (let i=1; i <=pagination.totalPages; i++) { %>
                                                                    <a href="/community/<%= currentTab %>?page=<%= i %>"
                                                                        class="pg-btn <%= i === pagination.currentPage ? 'active' : '' %>">
                                                                        <%= i %>
                                                                    </a>
                                                                    <% } %>

                                                                        <% if (pagination.currentPage <
                                                                            pagination.totalPages) { %>
                                                                            <a href="/community/<%= currentTab %>?page=<%= pagination.currentPage + 1 %>"
                                                                                class="pg-btn">›</a>
                                                                            <% } %>
                                                    </div>
                                                    <% } %>
                                                        <% } else { %>
                                                            <div
                                                                style="text-align: center; padding: 100px 0; color: #999;">
                                                                <i class="fa-solid fa-inbox"
                                                                    style="font-size: 3rem; margin-bottom: 20px; color: var(--primary-blue);"></i>
                                                                <p style="font-size: 1.2rem;">등록된 게시글이 없습니다.</p>
                                                            </div>
                                                            <% } %>
                                        </div>
                    </div>
                </div>
            </main>

            <%- include('../partials/footer', { isGate: false }) %>
    </div>

    <script>
        // GSAP 스크롤 트리거 활성화
        window.addEventListener('load', () => {
            gsap.utils.toArray('.fade-up').forEach((el, i) => {
                gsap.from(el, {
                    scrollTrigger: {
                        trigger: el,
                        start: "top 85%",
                        toggleActions: "play none none reverse"
                    },
                    opacity: 0,
                    y: 30,
                    duration: 0.8,
                    delay: i * 0.1
                });
            });
        });
    </script>
</body>

</html>